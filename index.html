<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login / Register</title>
  <link href="https://fonts.googleapis.com/css2?family=Berkshire+Swash&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Rancho&display=swap" rel="stylesheet">
</head>
<body>
<div class="card">

  <form id="loginForm">
    <h1 style="font-family: 'Berkshire Swash', cursive; text-align:center;">
      Welcome!
    </h1>
    <h2>Login</h2>
    <input type="text" id="login-username" placeholder="Username or Email" required>
    <div class="password-wrapper">
      <input type="password" id="login-password" placeholder="Password" required>
      <span id="togglePassword" class="toggle-icon">üôà</span>
    </div>
    <button type="submit">Login</button>
    <p>Don‚Äôt have an account?
      <a href="#" id="showRegister">Register</a>
    </p>
  </form>

  <form id="registerForm" class="hidden">
    <h2>Register</h2>
    <input type="text" id="reg-username" placeholder="Username" required>
    
    <div id="email-group">
      <input type="email" id="reg-email" placeholder="Email" required>
      <div id="email-validation-message" class="validation-message"></div> 
    </div>
    
    <div id="phone-group">
      <input type="tel" id="reg-phone" placeholder="Phone" required disabled>
      <div id="phone-validation-message" class="validation-message"></div>
    </div>
    
    <div id="password-group" class="password-wrapper">
      <input type="password" id="reg-password" placeholder="Password" required disabled>
      <span id="togglePasswordReg" class="toggle-icon">üôà</span>
      <div id="password-validation-message" class="validation-message"></div>
    </div>
    
    <div class="password-wrapper">
      <input type="password" id="reg-confirm" placeholder="Confirm Password" required disabled>
    </div>
    <button type="submit" disabled>Create Account</button>
    <p>Already have an account?
      <a href="#" id="showLogin">Back to Login</a>
    </p>
  </form>
</div>

<div id="popup" class="popup hidden">
  <div class="popup-content">
    <div id="popupIcon">‚úî</div>
    <h3 id="popupMessage">Welcome!</h3>
  </div>
</div>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: url("login/One Piece Wallpaper.jpg") center/cover no-repeat fixed;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.card {
  background: rgba(180, 211, 231, 0.45); 
  padding: 24px;
  border-radius: 10px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.50);
  width: 350px;
  backdrop-filter: blur(4px); 
}
.card input {
  width: 95%;
  padding: 10px;
  margin: 8px 0;
  border: 1px solid #ccc;
  border-radius: 4px;
}

#loginForm h2,
#loginForm p,
#registerForm h2,
#registerForm p {
  text-align: center;
  margin: 12px 0;
}

.card button {
  width: 100%;
  padding: 10px;
  margin-top: 8px;
  background: #42051e;
  color: #fff;
  border: none;
  border-radius: 4px;
  font-size: 16px;
  cursor: pointer;
}
.card a {
  color: #42051e;
  text-decoration: none;
}
.card a:hover {
  color: #42051e;
  text-decoration: none;
}

.hidden { display: none; }

.password-wrapper {
  position: relative;
  width: 100%;
  margin: 8px 0;
}
.password-wrapper input {
  width: 100%;
  padding: 10px;
  padding-right: 40px;
  box-sizing: border-box;
}
#password-group .validation-message {
    margin-top: 2px;
}

.toggle-icon {
  position: absolute;
  top: 50%;
  right: 10px;
  transform: translateY(-50%);
  cursor: pointer;
  user-select: none;
  font-size: 18px;
  z-index: 10; 
}


.validation-message {
  color: #000000;
  font-size: 0.85em;
  margin-top: -6px;
  margin-bottom: 8px;
  padding-left: 5px;
  min-height: 20px; 
}

.popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(255, 255, 255, 0.95);
  padding: 80px 100px;
  border-radius: 20px;
  box-shadow: 0 8px 30px rgba(0,0,0,0.3);
  text-align: center;
  max-width: 500px;
  width: 80%;
  animation: fadeIn 0.4s ease;
}

.popup-content {
  background: #fff;
  font-size: 3rem;
  font-family: 'Rancho', cursive;
  text-align: center;
  font-weight: bold;
  color: #333;
  text-shadow: 2px 2px 6px rgba(0,0,0,0.3);
  animation: popIn 0.5s ease-out;
}

@keyframes popIn {
  0% { transform: scale(0.5); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}
</style>

<script>
const loginForm = document.getElementById('loginForm');
const registerForm = document.getElementById('registerForm');

// Get registration inputs
const regEmail = document.getElementById('reg-email');
const regPhone = document.getElementById('reg-phone');
const regPassword ¬†= document.getElementById('reg-password');
const regConfirmPassword = document.getElementById('reg-confirm');
const regSubmitButton ¬†= registerForm.querySelector('button[type="submit"]');

const emailMessage = document.getElementById('email-validation-message');
const phoneMessage = document.getElementById('phone-validation-message');
const passwordMessage = document.getElementById('password-validation-message');


function setPhoneAndSubsequentFieldsState(isEnabled) {
  regPhone.disabled = !isEnabled;
  if (!isEnabled) {
    regPassword.disabled ¬†= true;
    regConfirmPassword.disabled = true;
    regSubmitButton.disabled = true;
  }
}

function setConfirmAndSubmitState(isEnabled) {
  regConfirmPassword.disabled = !isEnabled;
  regSubmitButton.disabled = !isEnabled; 
}

setPhoneAndSubsequentFieldsState(false);


regEmail.addEventListener('input', () => {
  const emailValue = regEmail.value.trim();
  const isValidEmail = emailValue.includes('@');
  
  if (emailValue.length > 0 && !isValidEmail) {
    emailMessage.textContent = "Email must contain the '@' symbol to continue.";
    setPhoneAndSubsequentFieldsState(false);
  } else {
    emailMessage.textContent = "";
    setPhoneAndSubsequentFieldsState(true);
    validatePhoneNumber(); 
  }
});

regPhone.addEventListener('input', validatePhoneNumber);

function validatePhoneNumber() {
  const phoneValue = regPhone.value.trim();
  const isCorrectLength = phoneValue.length === 11;
  const startsWith09 = phoneValue.startsWith('09');
  
  phoneMessage.textContent = "";
  setConfirmAndSubmitState(false); 
  regPassword.disabled = true;

  if (phoneValue.length > 0) {
    if (!isCorrectLength && startsWith09) {
      phoneMessage.textContent = "Phone number must contain 11 digits.";
      return;
    } 
    
    if (isCorrectLength && !startsWith09) {
      phoneMessage.textContent = "Phone number must start with 09.";
      return;
    }
    
    if (!isCorrectLength && !startsWith09) {
      phoneMessage.textContent = "Phone number must start with 09 and contain 11 digits.";
      return;
    }

    if (isCorrectLength && startsWith09) {
      phoneMessage.textContent = ""; 
      regPassword.disabled = false; 
      validatePassword(); 
      return;
    }
  }
}


regPassword.addEventListener('input', validatePassword);

function validatePassword() {
  const passwordValue = regPassword.value;
  const length = passwordValue.length;
  const hasLetter = /[a-zA-Z]/.test(passwordValue);
  const hasNumber = /[0-9]/.test(passwordValue);
  const isAlphanumeric = /^[a-zA-Z0-9]*$/.test(passwordValue);
  
  passwordMessage.textContent = "";
  setConfirmAndSubmitState(false);

  if (length > 0) {
    if (!isAlphanumeric) {
      passwordMessage.textContent = "Password is not valid (must contain only letters and numbers).";
    } else if (length < 6) {
      passwordMessage.textContent = "Password must be at least 6 characters long.";
    } else if (!hasLetter) {
      passwordMessage.textContent = "Password must contain at least one letter.";
    } else if (!hasNumber) {
      passwordMessage.textContent = "Password must contain at least one number.";
    } else {
      // Password meets all requirements
      passwordMessage.textContent = "";
      setConfirmAndSubmitState(true);
      validatePasswordMatch();
      return;
    }
  }
}

function validatePasswordMatch() {
  const pass1 = regPassword.value;
  const pass2 = regConfirmPassword.value;

  
  if (pass1 === pass2 && pass1.length > 0) {
    regConfirmPassword.setCustomValidity("");
    regSubmitButton.disabled = false;
  } else if (pass2.length > 0) {
    regConfirmPassword.setCustomValidity("Passwords do not match!");
    regSubmitButton.disabled = true;
  } else {
    regConfirmPassword.setCustomValidity("");
    regSubmitButton.disabled = true;
  }
  regConfirmPassword.reportValidity(); 
}

regConfirmPassword.addEventListener('input', validatePasswordMatch);


function showPopup(message, isSuccess = true, callback = null) {
  let popup = document.createElement("div");
  popup.className = "popup " + (isSuccess ? "success" : "error");
  popup.innerHTML = `<div class="popup-content">
                        ${isSuccess ? "‚úÖ" : "‚ùå"} ${message}
                      </div>`;
  document.body.appendChild(popup);

  setTimeout(() => { popup.classList.add("show"); }, 50);
  setTimeout(() => {
    popup.classList.remove("show");
    setTimeout(() => {
      popup.remove();
      if (callback) callback();
    }, 300);
  }, 2000);
}

document.getElementById('showRegister').addEventListener('click', e => {
  e.preventDefault();
  loginForm.classList.add('hidden');
  registerForm.classList.remove('hidden');
  
  registerForm.reset();
  emailMessage.textContent = '';
  phoneMessage.textContent = '';
  passwordMessage.textContent = '';
  regConfirmPassword.setCustomValidity(""); 
  setPhoneAndSubsequentFieldsState(false);
});
document.getElementById('showLogin').addEventListener('click', e => {
  e.preventDefault();
  registerForm.classList.add('hidden');
  loginForm.classList.remove('hidden');
});

registerForm.addEventListener('submit', e => {
  e.preventDefault();

  validatePassword();
  if (passwordMessage.textContent !== "") {
    regPassword.reportValidity();
    return;
  }
  
  validatePasswordMatch();

  if (regConfirmPassword.customError) {
    regConfirmPassword.reportValidity();
    return;
  } 

  const username = document.getElementById('reg-username');
  
  let users = JSON.parse(localStorage.getItem("users")) || [];
  users.push({
    username: username.value.trim(),
    email: regEmail.value.trim(),
    phone: regPhone.value.trim(),
    password: regPassword.value.trim()
  });
  localStorage.setItem("users", JSON.stringify(users));

  showPopup("Registration successful!", true, () => {
    registerForm.reset();
    registerForm.classList.add("hidden");
    loginForm.classList.remove("hidden");
    setPhoneAndSubsequentFieldsState(false);
  });
});

//Login check
loginForm.addEventListener('submit', e => {
  e.preventDefault();
  const username = document.getElementById('login-username');
  const password = document.getElementById('login-password');

  let users = JSON.parse(localStorage.getItem("users")) || [];
  const foundUser = users.find(u =>
    (u.username === username.value.trim() || u.email === username.value.trim()) 
    && u.password === password.value.trim()
  );

  if (foundUser) {
    localStorage.setItem("activeUser", foundUser.username);
    showPopup("Welcome, " + foundUser.username + "!", true, () => {
      window.location.href = "homepage.html";
    });
  } else {
    username.setCustomValidity("Invalid username or password!");
    username.reportValidity();
    setTimeout(() => { username.setCustomValidity(""); }, 10); 
  }
});

function logout() {
  localStorage.removeItem("activeUser");
  loginForm.reset();
}
window.logout = logout;

document.querySelectorAll(".password-wrapper").forEach(wrapper => {
  const input = wrapper.querySelector("input");
  let icon = wrapper.querySelector(".toggle-icon");

  if (!icon) {
    icon = document.createElement("span");
    icon.classList.add("toggle-icon");
    icon.textContent = "üôà";
    wrapper.appendChild(icon);
  }

  icon.addEventListener("click", () => {
    const type = input.type === "password" ? "text" : "password";
    input.type = type;
    icon.textContent = type === "password" ? "üôà" : "üôâ";
  });
});
</script>
</body>
</html>